<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lush Labs Suite - Complete Manufacturing Operations</title>
    
    <!-- TailwindCSS CDN with Custom Configuration -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sage: {
                            50: '#f0f4f0',
                            100: '#dae6da',
                            200: '#b8d0b8',
                            300: '#8fb48f',
                            400: '#6b9b6b',
                            500: '#5c7a5c',
                            600: '#4a6b4a',
                            700: '#3d563d',
                            800: '#334533',
                            900: '#2d3a2d',
                        },
                        cream: {
                            50: '#fefdf9',
                            100: '#fefcf3',
                            200: '#fef7e7',
                            300: '#feedd5',
                            400: '#fde1a3',
                            500: '#fbcd6f',
                            600: '#f7b955',
                            700: '#f3a43d',
                            800: '#ee8e2d',
                            900: '#e07c1e',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Neon Database Configuration -->
    <script>
        // Neon Database Configuration for Lush Labs Suite
        console.log('ðŸŽ¯ Initializing Neon Database integration for Lush Labs Suite');
        
        // Override fetch to use Netlify Functions for database access
        const originalFetch = window.fetch;
        window.fetch = function(url, options = {}) {
            // Check if this is a table API call
            if (url.startsWith('/tables/') || url.startsWith('tables/')) {
                let tableName = url.replace('/tables/', '').replace('tables/', '');
                let recordId = null;
                
                if (tableName.includes('/')) {
                    const parts = tableName.split('/');
                    tableName = parts[0];
                    recordId = parts[1];
                }
                
                let queryParams = '';
                if (url.includes('?')) {
                    queryParams = url.split('?')[1];
                    tableName = tableName.split('?')[0];
                }
                
                // Use Netlify Functions for database access
                let neonUrl = `/.netlify/functions/db-query/${tableName}`;
                if (recordId) {
                    neonUrl += `/${recordId}`;
                }
                if (queryParams) {
                    neonUrl += `?${queryParams}`;
                }
                
                console.log(`Neon DB API: ${options.method || 'GET'} ${neonUrl}`);
                
                return originalFetch(neonUrl, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                }).then(response => {
                    return response.json().then(data => {
                        // Handle the response format
                        return {
                            ok: response.ok,
                            status: response.status,
                            json: () => Promise.resolve(data)
                        };
                    });
                });
            }
            
            // Handle auth login
            if (url.includes('/auth/login') || url.includes('auth/login')) {
                const credentials = JSON.parse(options.body);
                if ((credentials.email === 'admin@luxebeauty.com' && credentials.password === 'admin123') ||
                    (credentials.email === 'hello@starseednatural.com' && credentials.password === 'starseed123')) {
                    return Promise.resolve({
                        ok: true,
                        json: () => Promise.resolve({
                            success: true,
                            user: {
                                id: 'user-id',
                                email: credentials.email,
                                name: credentials.email.includes('admin') ? 'System Administrator' : 'Star Seed Natural',
                                role: credentials.email.includes('admin') ? 'Admin' : 'Client User',
                                client_id: credentials.email.includes('starseed') ? 'SSN001' : null,
                                tenant_id: 'luxebeauty_001'
                            }
                        })
                    });
                } else {
                    return Promise.resolve({
                        ok: false,
                        json: () => Promise.resolve({ success: false, error: 'Invalid credentials' })
                    });
                }
            }
            
            return originalFetch(url, options);
        };
        
        console.log('ðŸš€ Neon Database integration configured for Lush Labs Suite');
    </script>
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #f0f4f0 0%, #dae6da 50%, #fefdf9 100%);
        }
        .lush-bg {
            background: linear-gradient(135deg, #f0f4f0 0%, #dae6da 50%, #fefdf9 100%);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .sage-gradient {
            background: linear-gradient(135deg, #5c7a5c 0%, #6b9b6b 100%);
        }
        .cream-gradient {
            background: linear-gradient(135deg, #fbcd6f 0%, #f7b955 100%);
        }
    </style>
</head>

<body class="lush-bg min-h-screen">
    <!-- Navigation Header -->
    <nav class="glass-effect shadow-xl border-b border-sage-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-leaf text-2xl text-sage-600 mr-3"></i>
                        <h1 class="text-xl font-bold text-sage-900">Lush Labs Suite</h1>
                        <span class="ml-3 text-sm text-sage-600 bg-sage-100 px-2 py-1 rounded-full">Manufacturing Operations</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="userInfo" class="hidden flex items-center space-x-3 text-sm text-sage-700">
                        <i class="fas fa-user-circle text-lg"></i>
                        <span id="userName"></span>
                    </div>
                    <button id="logoutBtn" onclick="logout()" class="hidden bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                        <i class="fas fa-sign-out-alt mr-1"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Login Section -->
    <div id="loginSection" class="flex items-center justify-center min-h-screen p-4">
        <div class="glass-effect rounded-3xl shadow-2xl p-8 max-w-md w-full border border-sage-200">
            <div class="text-center mb-8">
                <div class="sage-gradient rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-leaf text-2xl text-white"></i>
                </div>
                <h2 class="text-3xl font-bold text-sage-900 mb-2">Lush Labs Suite</h2>
                <p class="text-sage-600 mb-2">Complete Manufacturing Operations Platform</p>
                <p class="text-xs text-sage-500">Formulation â€¢ Production â€¢ Fulfillment â€¢ Analytics</p>
                <div class="mt-4 flex items-center justify-center space-x-2 text-sm text-emerald-600">
                    <i class="fas fa-database"></i>
                    <span>Powered by Neon PostgreSQL</span>
                </div>
            </div>
            
            <div class="space-y-4">
                <button onclick="loginAs('admin')" class="w-full sage-gradient hover:opacity-90 text-white font-medium py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-user-shield mr-2"></i>
                    Manufacturing Administrator
                </button>
                <button onclick="loginAs('client')" class="w-full cream-gradient hover:opacity-90 text-white font-medium py-3 px-4 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                    <i class="fas fa-building mr-2"></i>
                    Client Portal Access
                </button>
            </div>
            
            <div class="mt-6 text-center text-xs text-sage-500 space-y-1">
                <p>Admin: admin@luxebeauty.com / admin123</p>
                <p>Client: hello@starseednatural.com / starseed123</p>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardSection" class="hidden">
        <!-- Sidebar Navigation -->
        <div class="flex min-h-screen">
            <div id="sidebar" class="w-64 glass-effect shadow-xl border-r border-sage-200">
                <div class="p-4">
                    <h3 class="text-lg font-semibold text-sage-900 mb-4">Operations Center</h3>
                    
                    <!-- Main Navigation -->
                    <nav class="space-y-2">
                        <button onclick="showDashboard()" class="nav-btn w-full text-left px-4 py-3 rounded-lg bg-sage-100 text-sage-900 font-medium">
                            <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                        </button>
                        <button onclick="showClients()" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-sage-700 hover:bg-sage-100 transition-colors">
                            <i class="fas fa-users mr-3"></i>Client Management
                        </button>
                        <button onclick="showOrders()" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-sage-700 hover:bg-sage-100 transition-colors">
                            <i class="fas fa-shopping-cart mr-3"></i>Order Management
                        </button>
                        <button onclick="showFulfillment()" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-sage-700 hover:bg-sage-100 transition-colors">
                            <i class="fas fa-truck mr-3"></i>Fulfillment Center
                        </button>
                        <button onclick="showFormulations()" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-sage-700 hover:bg-sage-100 transition-colors">
                            <i class="fas fa-flask mr-3"></i>Formulations & BOM
                        </button>
                        <button onclick="showInvoicing()" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-sage-700 hover:bg-sage-100 transition-colors">
                            <i class="fas fa-file-invoice-dollar mr-3"></i>Auto-Invoicing
                        </button>
                        <button onclick="showShipping()" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-sage-700 hover:bg-sage-100 transition-colors">
                            <i class="fas fa-shipping-fast mr-3"></i>Royal Mail Integration
                        </button>
                        <button onclick="showWix()" class="nav-btn w-full text-left px-4 py-3 rounded-lg text-sage-700 hover:bg-sage-100 transition-colors">
                            <i class="fas fa-store mr-3"></i>Wix Store Sync
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="flex-1 p-6">
                
                <!-- Dashboard View -->
                <div id="dashboardView" class="dashboard-view">
                    
                    <!-- Welcome Header -->
                    <div class="glass-effect rounded-2xl p-6 mb-8 border border-sage-200">
                        <div class="text-center">
                            <h2 class="text-3xl font-bold text-sage-900 mb-2">ðŸŒ¿ Welcome to Lush Labs Suite</h2>
                            <p class="text-sage-600">Complete Manufacturing Operations Platform â€¢ Live Database Connection</p>
                            <div class="mt-4 flex items-center justify-center space-x-6 text-sm">
                                <div class="flex items-center space-x-2 text-emerald-600">
                                    <i class="fas fa-circle text-xs"></i>
                                    <span>Neon Database Active</span>
                                </div>
                                <div class="flex items-center space-x-2 text-blue-600">
                                    <i class="fas fa-circle text-xs"></i>
                                    <span>Netlify Functions Online</span>
                                </div>
                                <div class="flex items-center space-x-2 text-purple-600">
                                    <i class="fas fa-circle text-xs"></i>
                                    <span>Real-time Operations</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="glass-effect rounded-xl p-6 text-center border border-sage-200">
                            <div class="sage-gradient rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-users text-white"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-sage-900">Active Clients</h3>
                            <p class="text-3xl font-bold text-sage-600" id="clientCount">Loading...</p>
                        </div>
                        <div class="glass-effect rounded-xl p-6 text-center border border-sage-200">
                            <div class="cream-gradient rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-shopping-cart text-white"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-sage-900">Pending Orders</h3>
                            <p class="text-3xl font-bold text-cream-600" id="orderCount">Loading...</p>
                        </div>
                        <div class="glass-effect rounded-xl p-6 text-center border border-sage-200">
                            <div class="bg-blue-500 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-flask text-white"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-sage-900">Formulations</h3>
                            <p class="text-3xl font-bold text-blue-600" id="formulationCount">Loading...</p>
                        </div>
                        <div class="glass-effect rounded-xl p-6 text-center border border-sage-200">
                            <div class="bg-emerald-500 rounded-full w-12 h-12 flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-boxes text-white"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-sage-900">Products</h3>
                            <p class="text-3xl font-bold text-emerald-600" id="productCount">Loading...</p>
                        </div>
                    </div>

                    <!-- Main Operations Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        
                        <!-- Quick Formulation Calculator -->
                        <div class="glass-effect rounded-2xl p-8 border border-sage-200">
                            <div class="flex items-center mb-6">
                                <div class="sage-gradient rounded-lg p-3 mr-4">
                                    <i class="fas fa-calculator text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-sage-900">Formulation Calculator</h3>
                                    <p class="text-sage-600 text-sm">Quick batch calculations with automated numbering</p>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-sage-700 mb-2">Product Selection</label>
                                    <select id="quickProductSelect" class="w-full px-4 py-3 border border-sage-300 rounded-lg focus:ring-2 focus:ring-sage-500 focus:border-sage-500">
                                        <option value="">Choose Product...</option>
                                        <option value="SSN-FC-20">Star Seed â€¢ Forest Cream 20ml</option>
                                        <option value="SSN-FC-50">Star Seed â€¢ Forest Cream 50ml</option>
                                        <option value="SSN-MC-20">Star Seed â€¢ Moon Cream 20ml</option>
                                        <option value="SSN-MC-50">Star Seed â€¢ Moon Cream 50ml</option>
                                        <option value="SSN-SS-12">Star Seed â€¢ Star Serum 12ml</option>
                                        <option value="SSN-SS-18">Star Seed â€¢ Star Serum 18ml</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-sage-700 mb-2">Batch Size (kg)</label>
                                    <input type="number" id="quickBatchSize" step="0.1" min="0.1" 
                                           class="w-full px-4 py-3 border border-sage-300 rounded-lg focus:ring-2 focus:ring-sage-500 focus:border-sage-500"
                                           placeholder="Enter target batch size">
                                </div>
                                
                                <button onclick="quickCalculate()" class="w-full sage-gradient text-white font-semibold py-3 px-6 rounded-lg hover:opacity-90 transition-all duration-200 transform hover:scale-105 shadow-lg">
                                    <i class="fas fa-calculator mr-2"></i>Calculate & Generate Batch Number
                                </button>
                            </div>
                            
                            <div id="quickResults" class="hidden mt-6 p-4 bg-sage-50 border border-sage-200 rounded-lg">
                                <h4 class="font-semibold text-sage-800 mb-2">
                                    <i class="fas fa-check-circle mr-2"></i>Batch Calculation Ready
                                </h4>
                                <div id="quickResultDetails"></div>
                            </div>
                        </div>

                        <!-- Recent Activity & Alerts -->
                        <div class="glass-effect rounded-2xl p-8 border border-sage-200">
                            <div class="flex items-center mb-6">
                                <div class="cream-gradient rounded-lg p-3 mr-4">
                                    <i class="fas fa-bell text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-sage-900">System Alerts & Activity</h3>
                                    <p class="text-sage-600 text-sm">Real-time notifications and recent operations</p>
                                </div>
                            </div>
                            
                            <div id="alertsList" class="space-y-3">
                                <div class="flex items-center p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <i class="fas fa-exclamation-triangle text-yellow-600 mr-3"></i>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-yellow-800">Stock Alert: Moon Cream 20ml</p>
                                        <p class="text-xs text-yellow-600">Current: 18 units â€¢ Minimum: 20 units</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                    <i class="fas fa-info-circle text-blue-600 mr-3"></i>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-blue-800">New Order: Discovery Kit x5</p>
                                        <p class="text-xs text-blue-600">Star Seed Natural â€¢ Priority fulfillment</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center p-3 bg-green-50 border border-green-200 rounded-lg">
                                    <i class="fas fa-check-circle text-green-600 mr-3"></i>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-green-800">Batch F130925 Completed</p>
                                        <p class="text-xs text-green-600">Forest Cream 20ml â€¢ 10kg batch</p>
                                    </div>
                                </div>
                            </div>
                            
                            <button onclick="loadRecentActivity()" class="w-full mt-4 text-sage-600 hover<span class="cursor">â–ˆ</span>
